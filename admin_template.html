<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù†ØµØ© Ù†ÙŠÙˆ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container-fluid { max-width: 1400px; }
        .form-section { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .table-responsive { font-size: 0.9em; }
        .table th { background-color: #e9ecef; }
    </style>
</head>
<body>

<div class="container-fluid mt-4">
    <h1 class="mb-4 text-center">ğŸ“š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h1>

    <!-- Add New Resource Form -->
    <div class="form-section">
        <form method="post" action="/admin/add" enctype="multipart/form-data">
            <input type="hidden" name="password" value="admin123">

            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
                    <select id="stage_id" name="stage_id" class="form-select" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„ÙØµÙ„</label>
                    <select id="term_id" name="term_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„ØµÙ</label>
                    <select id="grade_id" name="grade_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="subject_id" name="subject_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                    <select id="option_id" name="option_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select id="child_id" name="child_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <select id="subchild_id" name="subchild_id" class="form-select" disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ...</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="title" name="title" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label>
                    <input type="url" id="url" name="url" class="form-control" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ PDF Ø£Ø¯Ù†Ø§Ù‡">
                </div>
                <div class="col-md-2 mb-3 d-flex align-items-end">
                    <input type="file" id="file" name="file" class="form-control" accept=".pdf,application/pdf">
                </div>
            </div>

            <button type="submit" class="btn btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
        </form>
    </div>

    <hr>

    <h2 class="mb-3">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹</h2>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>#</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ø±Ø§Ø¨Ø·</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody>
                __ROWS__
            </tbody>
        </table>
    </div>
</div>

<script>
// --- Data injected from FastAPI ---
const stages = __STAGES__;
const terms = __TERMS__;
const grades = __GRADES__;
const subjects = __SUBJECTS__;
const options = __OPTIONS__;
const children = __CHILDREN__;
const subchildren = __SUBCHILDREN__;
const subjectOptionMap = __SUBJOPT__;

// DOM elements
const stageSelect = document.getElementById('stage_id');
const termSelect = document.getElementById('term_id');
const gradeSelect = document.getElementById('grade_id');
const subjectSelect = document.getElementById('subject_id');
const optionSelect = document.getElementById('option_id');
const childSelect = document.getElementById('child_id');
const subchildSelect = document.getElementById('subchild_id');

// Helper to populate dropdown
function populateDropdown(select, data, placeholder = "Ø§Ø®ØªØ±...") {
    select.innerHTML = `<option value="">${placeholder}</option>`;
    if (!data) return;
    data.forEach(item => {
        const opt = new Option(item.name, item.id);
        select.add(opt);
    });
}

// Cascading logic
stageSelect.addEventListener('change', () => {
    const stageId = stageSelect.value;
    termSelect.disabled = !stageId;
    populateDropdown(termSelect, terms.filter(t => t.stage_id == stageId), "Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„...");
    gradeSelect.disabled = true;  populateDropdown(gradeSelect, []);
    subjectSelect.disabled = true; populateDropdown(subjectSelect, []);
    optionSelect.disabled = true;  populateDropdown(optionSelect, []);
    childSelect.disabled = true;   populateDropdown(childSelect, []);
    subchildSelect.disabled = true;populateDropdown(subchildSelect, []);
});

termSelect.addEventListener('change', () => {
    const termId = termSelect.value;
    gradeSelect.disabled = !termId;
    populateDropdown(gradeSelect, grades.filter(g => g.term_id == termId), "Ø§Ø®ØªØ± Ø§Ù„ØµÙ...");
    subjectSelect.disabled = true; populateDropdown(subjectSelect, []);
    optionSelect.disabled = true;  populateDropdown(optionSelect, []);
    childSelect.disabled = true;   populateDropdown(childSelect, []);
    subchildSelect.disabled = true;populateDropdown(subchildSelect, []);
});

gradeSelect.addEventListener('change', () => {
    const gradeId = gradeSelect.value;
    subjectSelect.disabled = !gradeId;
    populateDropdown(subjectSelect, subjects.filter(s => s.grade_id == gradeId), "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...");
    optionSelect.disabled = true;  populateDropdown(optionSelect, []);
    childSelect.disabled = true;   populateDropdown(childSelect, []);
    subchildSelect.disabled = true;populateDropdown(subchildSelect, []);
});

subjectSelect.addEventListener('change', () => {
    const subjectId = subjectSelect.value;
    if (!subjectId) {
        optionSelect.disabled = true;
        populateDropdown(optionSelect, []);
        return;
    }
    const allowedOptionIds = subjectOptionMap
        .filter(m => m.subject_id == subjectId)
        .map(m => m.option_id);
    const availableOptions = options.filter(o => allowedOptionIds.includes(o.id));
    optionSelect.disabled = availableOptions.length === 0;
    populateDropdown(optionSelect, availableOptions, "Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...");
    childSelect.disabled = true;   populateDropdown(childSelect, []);
    subchildSelect.disabled = true;populateDropdown(subchildSelect, []);
});

optionSelect.addEventListener('change', () => {
    const optionId = optionSelect.value;
    childSelect.disabled = !optionId;
    populateDropdown(childSelect, children.filter(c => c.option_id == optionId), "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...");
    subchildSelect.disabled = true;populateDropdown(subchildSelect, []);
});

childSelect.addEventListener('change', () => {
    const childId = childSelect.value;
    const subs = subchildren.filter(sc => sc.child_id == childId);
    subchildSelect.disabled = subs.length === 0;
    populateDropdown(subchildSelect, subs, subs.length ? "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ..." : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… ÙØ±Ø¹ÙŠØ©");
});

// initial load
document.addEventListener('DOMContentLoaded', () => {
    populateDropdown(stageSelect, stages, "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©...");
});
</script>

</body>
</html>
