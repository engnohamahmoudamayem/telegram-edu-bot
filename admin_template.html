<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù†ØµØ© Ù†ÙŠÙˆ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container-fluid { max-width: 1400px; }
        .form-section { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .table-responsive { font-size: 0.9em; }
        .table th { background-color: #e9ecef; }
    </style>
</head>
<body>

<div class="container-fluid mt-4">
    <h1 class="mb-4 text-center">ğŸ“š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h1>

    <!-- Add New Resource Form -->
    <div class="form-section">
        <form method="post" action="/admin/add" enctype="multipart/form-data">
            <input type="hidden" name="password" value="admin123"> <!-- Simple password for demo -->

            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="stage_id" class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
                    <select id="stage_id" name="stage_id" class="form-select" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="term_id" class="form-label">Ø§Ù„ÙØµÙ„</label>
                    <select id="term_id" name="term_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="grade_id" class="form-label">Ø§Ù„ØµÙ</label>
                    <select id="grade_id" name="grade_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ...</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="subject_id" class="form-label">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="subject_id" name="subject_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="option_id" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                    <select id="option_id" name="option_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="child_id" class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select id="child_id" name="child_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="subchild_id" class="form-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <select id="subchild_id" name="subchild_id" class="form-select" disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ...</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="title" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="title" name="title" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="url" class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label>
                    <input type="url" id="url" name="url" class="form-control" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù PDF Ø£Ø¯Ù†Ø§Ù‡">
                </div>
                <div class="col-md-2 mb-3 d-flex align-items-end">
                     <input type="file" id="file" name="file" class="form-control" accept=".pdf,application/pdf">
                </div>
            </div>

            <button type="submit" class="btn btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
        </form>
    </div>

    <hr>

    <!-- Existing Resources Table -->
    <h2 class="mb-3">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹</h2>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>#</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ø±Ø§Ø¨Ø·</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody>
                __ROWS__
            </tbody>
        </table>
    </div>
</div>

<script>
// --- Data injected from FastAPI ---
const stages = JSON.parse('__STAGES__');
const terms = JSON.parse('__TERMS__');
const grades = JSON.parse('__GRADES__');
const subjects = JSON.parse('__SUBJECTS__');
const options = JSON.parse('__OPTIONS__');
const children = JSON.parse('__CHILDREN__');
const subchildren = JSON.parse('__SUBCHILDREN__');
const subjectOptionMap = JSON.parse('__SUBJOPT__');

// --- DOM Elements ---
const stageSelect = document.getElementById('stage_id');
const termSelect = document.getElementById('term_id');
const gradeSelect = document.getElementById('grade_id');
const subjectSelect = document.getElementById('subject_id');
const optionSelect = document.getElementById('option_id');
const childSelect = document.getElementById('child_id');
const subchildSelect = document.getElementById('subchild_id');

// --- Helper function to populate a dropdown ---
function populateDropdown(selectElement, data, placeholder = "Ø§Ø®ØªØ±...") {
    selectElement.innerHTML = `<option value="">${placeholder}</option>`;
    if (data) {
        data.forEach(item => {
            const option = new Option(item.name, item.id);
            selectElement.add(option);
        });
    }
}

// --- Event Listeners for Cascading Dropdowns ---

stageSelect.addEventListener('change', () => {
    const selectedStageId = stageSelect.value;
    termSelect.disabled = !selectedStageId;
    populateDropdown(termSelect, terms.filter(t => t.stage_id == selectedStageId));
    // Reset subsequent dropdowns
    populateDropdown(gradeSelect); gradeSelect.disabled = true;
    populateDropdown(subjectSelect); subjectSelect.disabled = true;
    populateDropdown(optionSelect); optionSelect.disabled = true;
    populateDropdown(childSelect); childSelect.disabled = true;
    populateDropdown(subchildSelect); subchildSelect.disabled = true;
});

termSelect.addEventListener('change', () => {
    const selectedTermId = termSelect.value;
    gradeSelect.disabled = !selectedTermId;
    populateDropdown(gradeSelect, grades.filter(g => g.term_id == selectedTermId));
    // Reset subsequent dropdowns
    populateDropdown(subjectSelect); subjectSelect.disabled = true;
    populateDropdown(optionSelect); optionSelect.disabled = true;
    populateDropdown(childSelect); childSelect.disabled = true;
    populateDropdown(subchildSelect); subchildSelect.disabled = true;
});

gradeSelect.addEventListener('change', () => {
    const selectedGradeId = gradeSelect.value;
    subjectSelect.disabled = !selectedGradeId;
    populateDropdown(subjectSelect, subjects.filter(s => s.grade_id == selectedGradeId));
    // Reset subsequent dropdowns
    populateDropdown(optionSelect); optionSelect.disabled = true;
    populateDropdown(childSelect); childSelect.disabled = true;
    populateDropdown(subchildSelect); subchildSelect.disabled = true;
});

subjectSelect.addEventListener('change', () => {
    const selectedSubjectId = subjectSelect.value;
    if (!selectedSubjectId) {
        optionSelect.disabled = true;
        return;
    }
    
    const optionIds = subjectOptionMap.filter(map => map.subject_id == selectedSubjectId).map(map => map.option_id);
    const availableOptions = options.filter(o => optionIds.includes(o.id));
    
    optionSelect.disabled = availableOptions.length === 0;
    populateDropdown(optionSelect, availableOptions);
    // Reset subsequent dropdowns
    populateDropdown(childSelect); childSelect.disabled = true;
    populateDropdown(subchildSelect); subchildSelect.disabled = true;
});

optionSelect.addEventListener('change', () => {
    const selectedOptionId = optionSelect.value;
    childSelect.disabled = !selectedOptionId;
    populateDropdown(childSelect, children.filter(c => c.option_id == selectedOptionId));
    // Reset subsequent dropdown
    populateDropdown(subchildSelect); subchildSelect.disabled = true;
});

childSelect.addEventListener('change', () => {
    const selectedChildId = childSelect.value;
    const availableSubchildren = subchildren.filter(sc => sc.child_id == selectedChildId);
    subchildSelect.disabled = availableSubchildren.length === 0;
    populateDropdown(subchildSelect, availableSubchildren, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… ÙØ±Ø¹ÙŠØ©");
});


// --- Initial Population ---
document.addEventListener('DOMContentLoaded', () => {
    populateDropdown(stageSelect, stages);
});
</script>

</body>
</html>