<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <title>ููุญุฉ ุชุญูู ููู ุฃูุงุฏููู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #eef2ff, #e0f7fa);
            min-height: 100vh;
        }
        .card {
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: none;
        }
        .main-title {
            font-weight: 800;
            color: #1e293b;
        }
        .badge-nano {
            background: #0ea5e9;
            color: #fff;
            border-radius: 999px;
            padding: 3px 10px;
            font-size: 0.75rem;
        }
        .table thead th {
            background: #f1f5f9 !important;
            font-weight: 600;
        }
    </style>
</head>

<body class="p-3">

<div class="container-fluid">
    <div class="text-center mb-4">
        <h1 class="main-title">โจ ููุญุฉ ุชุญูู ููู ุฃูุงุฏููู โจ</h1>
        <span class="badge-nano mt-2">ุฅุฏุงุฑุฉ ุงูุฑูุงุจุท ููููุงุช PDF ููููุตุฉ</span>
    </div>

    <div class="row g-4">
        <!-- ููุฑู ุงูุฅุถุงูุฉ -->
        <div class="col-lg-5">
            <div class="card p-3">
                <h4 class="mb-3">โ ุฅุถุงูุฉ ุฑุงุจุท / PDF ุฌุฏูุฏ</h4>

                <form method="post" action="/admin/add" enctype="multipart/form-data">

                    <div class="mb-2">
                        <label class="form-label">ูููุฉ ุงููุฑูุฑ:</label>
                        <input type="password" name="password" class="form-control" required>
                    </div>

                    <div class="row g-2 mt-1">
                        <div class="col-6">
                            <label class="form-label">ุงููุฑุญูุฉ</label>
                            <select id="stage" name="stage_id" class="form-select" required></select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ุงููุตู</label>
                            <select id="term" name="term_id" class="form-select" required></select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ุงูุตู</label>
                            <select id="grade" name="grade_id" class="form-select" required></select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ุงููุงุฏุฉ</label>
                            <select id="subject" name="subject_id" class="form-select" required></select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ููุน ุงููุญุชูู</label>
                            <select id="option" name="option_id" class="form-select" required></select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ุงููุณู</label>
                            <select id="child" name="child_id" class="form-select" required></select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">ุงููุณู ุงููุฑุนู (ุงุฎุชูุงุฑู)</label>
                            <select id="subchild" name="subchild_id" class="form-select">
                                <option value="">ูุง ููุฌุฏ</option>
                            </select>
                        </div>
                    </div>

                    <hr>

                    <div class="mb-2">
                        <label class="form-label">ุงูุนููุงู</label>
                        <input type="text" name="title" class="form-control" required>
                    </div>

                    <div class="mb-2">
                        <label class="form-label">ุงูุฑุงุจุท (ุงุฎุชูุงุฑู)</label>
                        <input type="url" name="url" class="form-control" placeholder="https://...">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ููู PDF (ุงุฎุชูุงุฑู)</label>
                        <input type="file" name="file" accept=".pdf" class="form-control">
                    </div>

                    <button class="btn btn-primary w-100">๐พ ุญูุธ</button>
                </form>
            </div>
        </div>

        <!-- ุฌุฏูู ุงูุฑูุงุจุท -->
        <div class="col-lg-7">
            <div class="card p-3">
                <h4 class="mb-3">๐ ุฃุญุฏุซ ุงูุฑูุงุจุท</h4>
                <div class="table-responsive" style="max-height: 70vh; overflow:auto;">
                    <table class="table table-hover table-bordered align-middle">
                        <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>ุงููุฑุญูุฉ</th>
                            <th>ุงููุตู</th>
                            <th>ุงูุตู</th>
                            <th>ุงููุงุฏุฉ</th>
                            <th>ุงูููุน</th>
                            <th>ุงููุณู</th>
                            <th>ูุฑุนู</th>
                            <th>ุงูุนููุงู</th>
                            <th>ุงูุฑุงุจุท</th>
                            <th>ุชุนุฏูู</th>
                            <th>ุญุฐู</th>
                        </tr>
                        </thead>
                        <tbody>
                        __ROWS__
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ุงูุจูุงูุงุช ุงูุฎุงู ูู ุจุงูุซูู (ููุงุฆู ุนุงุฏูุฉ [[],[],...])
    const stagesRaw      = __STAGES__;
    const termsRaw       = __TERMS__;
    const gradesRaw      = __GRADES__;
    const subjectsRaw    = __SUBJECTS__;
    const optionsRaw     = __OPTIONS__;
    const childrenRaw    = __CHILDREN__;
    const subchildrenRaw = __SUBCHILDREN__;
    const subjOptRaw     = __SUBJOPT__;

    // ุชุญููููุง ููุงุฆูุงุช ุฃูุถุญ
    const stages = stagesRaw.map(r => ({ id: r[0], name: r[1] }));
    const terms = termsRaw.map(r => ({ id: r[0], name: r[1], stage_id: r[2] }));
    const grades = gradesRaw.map(r => ({ id: r[0], name: r[1], term_id: r[2] }));
    const subjects = subjectsRaw.map(r => ({ id: r[0], name: r[1], grade_id: r[2] }));
    const options = optionsRaw.map(r => ({ id: r[0], name: r[1] }));
    const children = childrenRaw.map(r => ({ id: r[0], name: r[1], option_id: r[2] }));
    const subchildren = subchildrenRaw.map(r => ({ id: r[0], name: r[1], child_id: r[2] }));
    const subjOptMap = subjOptRaw.map(r => ({ subject_id: r[0], option_id: r[1] }));

    function fill(sel, arr, placeholder) {
        sel.innerHTML = "";

        const first = document.createElement("option");
        first.value = "";
        first.textContent = placeholder;
        sel.appendChild(first);

        arr.forEach(item => {
            const opt = document.createElement("option");
            opt.value = item.id;
            opt.textContent = item.name;
            sel.appendChild(opt);
        });
    }

    const s  = document.getElementById("stage");
    const t  = document.getElementById("term");
    const g  = document.getElementById("grade");
    const sb = document.getElementById("subject");
    const op = document.getElementById("option");
    const ch = document.getElementById("child");
    const sc = document.getElementById("subchild");

    // ุฃูู ุชุญููู
    fill(s, stages, "ุงุฎุชุฑ ุงููุฑุญูุฉ");

    s.onchange = function () {
        const sid = parseInt(s.value || "0");
        fill(t, terms.filter(x => x.stage_id === sid), "ุงุฎุชุฑ ุงููุตู");
        fill(g, [], "ุงุฎุชุฑ ุงูุตู");
        fill(sb, [], "ุงุฎุชุฑ ุงููุงุฏุฉ");
        fill(op, [], "ุงุฎุชุฑ ุงูููุน");
        fill(ch, [], "ุงุฎุชุฑ ุงููุณู");
        sc.innerHTML = "<option value=''>ูุง ููุฌุฏ</option>";
    };

    t.onchange = function () {
        const tid = parseInt(t.value || "0");
        fill(g, grades.filter(x => x.term_id === tid), "ุงุฎุชุฑ ุงูุตู");
        fill(sb, [], "ุงุฎุชุฑ ุงููุงุฏุฉ");
        fill(op, [], "ุงุฎุชุฑ ุงูููุน");
        fill(ch, [], "ุงุฎุชุฑ ุงููุณู");
        sc.innerHTML = "<option value=''>ูุง ููุฌุฏ</option>";
    };

    g.onchange = function () {
        const gid = parseInt(g.value || "0");
        fill(sb, subjects.filter(x => x.grade_id === gid), "ุงุฎุชุฑ ุงููุงุฏุฉ");
        fill(op, [], "ุงุฎุชุฑ ุงูููุน");
        fill(ch, [], "ุงุฎุชุฑ ุงููุณู");
        sc.innerHTML = "<option value=''>ูุง ููุฌุฏ</option>";
    };

    sb.onchange = function () {
        const sid = parseInt(sb.value || "0");
        const allowed = subjOptMap
            .filter(x => x.subject_id === sid)
            .map(x => x.option_id);

        fill(op, options.filter(x => allowed.includes(x.id)), "ุงุฎุชุฑ ุงูููุน");
        fill(ch, [], "ุงุฎุชุฑ ุงููุณู");
        sc.innerHTML = "<option value=''>ูุง ููุฌุฏ</option>";
    };

    op.onchange = function () {
        const oid = parseInt(op.value || "0");
        fill(ch, children.filter(x => x.option_id === oid), "ุงุฎุชุฑ ุงููุณู");
        sc.innerHTML = "<option value=''>ูุง ููุฌุฏ</option>";
    };

    ch.onchange = function () {
        const cid = parseInt(ch.value || "0");
        fill(sc, subchildren.filter(x => x.child_id === cid), "ูุง ููุฌุฏ");
    };
</script>

</body>
</html>
