<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù†ØµØ© Ù†ÙŠÙˆ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background:#f5f5f5; }
        .container-fluid { max-width:1400px; }
        .form-section { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; }
        table td, table th { text-align:center; vertical-align:middle; }
        .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    </style>
</head>

<body>

<div class="container-fluid mt-4">

    <div class="top-bar">
        <h1 class="mb-0">ğŸ“š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h1>
        <a href="/logout" class="btn btn-danger">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>

    <!-- =====================  ADD FORM ===================== -->
    <div class="form-section shadow-sm">

        <h4 class="mb-3">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h4>

        <form method="post" action="/admin/add" enctype="multipart/form-data">

            <div class="row">

                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
                    <select id="stage_id" name="stage_id" class="form-select" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„ÙØµÙ„</label>
                    <select id="term_id" name="term_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„ØµÙ</label>
                    <select id="grade_id" name="grade_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="subject_id" name="subject_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...</option>
                    </select>
                </div>

            </div>

            <div class="row">

                <div class="col-md-4 mb-3">
                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                    <select id="option_id" name="option_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select id="child_id" name="child_id" class="form-select" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...</option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <select id="subchild_id" name="subchild_id" class="form-select" disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ...</option>
                    </select>
                </div>

            </div>

            <div class="row">

                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" name="title" class="form-control" required>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label>
                    <input type="url" name="url" class="form-control" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ÙŠ PDF">
                </div>

                <div class="col-md-2 mb-3 d-flex align-items-end">
                    <input type="file" name="file" class="form-control" accept=".pdf">
                </div>

            </div>

            <button type="submit" class="btn btn-primary px-4">âœ” Ø¥Ø¶Ø§ÙØ©</button>

        </form>

    </div>

    <hr>

    <!-- =====================  TABLE ===================== -->
    <h2 class="mb-3">ğŸ“„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¶Ø§Ù</h2>

    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>#</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„ØµÙ</th>
                    <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ÙØ±Ø¹ÙŠ</th>
                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>ÙØªØ­</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody>
                __ROWS__
            </tbody>
        </table>
    </div>

</div>


<!-- ====================== JSON ARRAYS READY FOR JS ===================== -->

<script>
const stages = __STAGES__;
const terms = __TERMS__;
const grades = __GRADES__;
const subjects = __SUBJECTS__;
const options = __OPTIONS__;
const children = __CHILDREN__;
const subchildren = __SUBCHILDREN__;
const subjectOptionMap = __SUBJOPT__;
</script>

<!-- ====================== DROPDOWNS LOGIC ===================== -->
<script>

function fill(select, list, placeholder) {
    select.innerHTML = `<option value="">${placeholder}</option>`;
    list.forEach(x => select.innerHTML += `<option value="${x.id}">${x.name}</option>`);
}

const stage = document.getElementById("stage_id");
const term = document.getElementById("term_id");
const grade = document.getElementById("grade_id");
const subject = document.getElementById("subject_id");
const option = document.getElementById("option_id");
const child = document.getElementById("child_id");
const subchild = document.getElementById("subchild_id");

// stage â†’ term
stage.onchange = () => {
    fill(term, terms.filter(t => t.stage_id == stage.value), "Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„...");
    term.disabled = false;

    grade.disabled = true; grade.innerHTML="";
    subject.disabled = true; subject.innerHTML="";
    option.disabled = true; option.innerHTML="";
    child.disabled = true; child.innerHTML="";
    subchild.disabled = true; subchild.innerHTML="";
};

// term â†’ grade
term.onchange = () => {
    fill(grade, grades.filter(g => g.term_id == term.value), "Ø§Ø®ØªØ± Ø§Ù„ØµÙ...");
    grade.disabled = false;
};

// grade â†’ subject
grade.onchange = () => {
    fill(subject, subjects.filter(s => s.grade_id == grade.value), "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...");
    subject.disabled = false;
};

// subject â†’ option
subject.onchange = () => {
    const allowed = subjectOptionMap
        .filter(x => x.subject_id == subject.value)
        .map(x => x.option_id);

    const opts = options.filter(o => allowed.includes(o.id));

    fill(option, opts, "Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...");
    option.disabled = false;
};

// option â†’ child
option.onchange = () => {
    fill(child, children.filter(c => c.option_id == option.value), "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...");
    child.disabled = false;
};

// child â†’ subchild
child.onchange = () => {
    const subs = subchildren.filter(sc => sc.child_id == child.value);
    fill(subchild, subs, subs.length ? "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ..." : "Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    subchild.disabled = subs.length === 0;
};

// Load stages at start
fill(stage, stages, "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©...");
</script>

</body>
</html>
