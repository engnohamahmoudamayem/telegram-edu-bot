<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู - ููุตุฉ ููู ุฃูุงุฏููู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background:#f5f5f5; }
        .container-fluid { max-width:1400px; }
        .form-section { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; }
        table td, table th { text-align:center; vertical-align:middle; }
    </style>
</head>

<body>

<div class="container-fluid mt-4">

    <h1 class="mb-4 text-center">๐ ููุญุฉ ุงูุชุญูู - ุฅุฏุงุฑุฉ ุงููุญุชูู</h1>

    <!-- =====================  ADD FORM ===================== -->
    <div class="form-section shadow-sm">

        <form method="post" action="/admin/add" enctype="multipart/form-data">

            <div class="row">

                <div class="col-md-3 mb-3">
                    <label class="form-label">ุงููุฑุญูุฉ</label>
                    <select id="stage_id" name="stage_id" class="form-select" required>
                        <option value="">ุงุฎุชุฑ ุงููุฑุญูุฉ...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">ุงููุตู</label>
                    <select id="term_id" name="term_id" class="form-select" required disabled>
                        <option value="">ุงุฎุชุฑ ุงููุตู...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">ุงูุตู</label>
                    <select id="grade_id" name="grade_id" class="form-select" required disabled>
                        <option value="">ุงุฎุชุฑ ุงูุตู...</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">ุงููุงุฏุฉ</label>
                    <select id="subject_id" name="subject_id" class="form-select" required disabled>
                        <option value="">ุงุฎุชุฑ ุงููุงุฏุฉ...</option>
                    </select>
                </div>

            </div>

            <div class="row">

                <div class="col-md-4 mb-3">
                    <label class="form-label">ููุน ุงููุญุชูู</label>
                    <select id="option_id" name="option_id" class="form-select" required disabled>
                        <option value="">ุงุฎุชุฑ ุงูููุน...</option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">ุงููุณู</label>
                    <select id="child_id" name="child_id" class="form-select" required disabled>
                        <option value="">ุงุฎุชุฑ ุงููุณู...</option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">ุงููุณู ุงููุฑุนู (ุงุฎุชูุงุฑู)</label>
                    <select id="subchild_id" name="subchild_id" class="form-select" disabled>
                        <option value="">ุงุฎุชุฑ ุงููุณู ุงููุฑุนู...</option>
                    </select>
                </div>

            </div>

            <div class="row">

                <div class="col-md-6 mb-3">
                    <label class="form-label">ุนููุงู ุงููุงุฏุฉ</label>
                    <input type="text" name="title" class="form-control" required>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">ุงูุฑุงุจุท ุงููุจุงุดุฑ</label>
                    <input type="url" name="url" class="form-control" placeholder="ุฃู ุงุฑูุนู PDF">
                </div>

                <div class="col-md-2 mb-3 d-flex align-items-end">
                    <input type="file" name="file" class="form-control" accept=".pdf">
                </div>

            </div>

            <button type="submit" class="btn btn-primary px-4">โ ุฅุถุงูุฉ</button>

        </form>

    </div>

    <hr>

    <!-- =====================  TABLE ===================== -->
    <h2>ุงูููุงุฏ ุงููุถุงูุฉ</h2>

    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>#</th><th>ุงููุฑุญูุฉ</th><th>ุงููุตู</th><th>ุงูุตู</th>
                    <th>ุงููุงุฏุฉ</th><th>ุงูููุน</th><th>ุงููุณู</th><th>ุงููุฑุนู</th>
                    <th>ุงูุนููุงู</th><th>ูุชุญ</th><th>ุชุนุฏูู</th><th>ุญุฐู</th>
                </tr>
            </thead>
            <tbody>
                __ROWS__
            </tbody>
        </table>
    </div>

</div>


<!-- ====================== INJECTED JSON ===================== -->

<script>
const stages = __STAGES__;
const terms = __TERMS__;
const grades = __GRADES__;
const subjects = __SUBJECTS__;
const options = __OPTIONS__;
const children = __CHILDREN__;
const subchildren = __SUBCHILDREN__;
const subjectOptionMap = __SUBJOPT__;
</script>

<!-- ====================== DROPDOWNS LOGIC ===================== -->
<script>

function fill(select, list, placeholder) {
    select.innerHTML = `<option value="">${placeholder}</option>`;
    list.forEach(x => select.innerHTML += `<option value="${x.id}">${x.name}</option>`);
}

const stage = document.getElementById("stage_id");
const term = document.getElementById("term_id");
const grade = document.getElementById("grade_id");
const subject = document.getElementById("subject_id");
const option = document.getElementById("option_id");
const child = document.getElementById("child_id");
const subchild = document.getElementById("subchild_id");

// stage โ term
stage.onchange = () => {
    fill(term, terms.filter(t => t.stage_id == stage.value), "ุงุฎุชุฑ ุงููุตู...");
    term.disabled = false;

    grade.disabled = true; grade.innerHTML="";
    subject.disabled = true; subject.innerHTML="";
    option.disabled = true; option.innerHTML="";
    child.disabled = true; child.innerHTML="";
    subchild.disabled = true; subchild.innerHTML="";
};

// term โ grade
term.onchange = () => {
    fill(grade, grades.filter(g => g.term_id == term.value), "ุงุฎุชุฑ ุงูุตู...");
    grade.disabled = false;
};

// grade โ subject
grade.onchange = () => {
    fill(subject, subjects.filter(s => s.grade_id == grade.value), "ุงุฎุชุฑ ุงููุงุฏุฉ...");
    subject.disabled = false;
};

// subject โ option
subject.onchange = () => {
    const allowed = subjectOptionMap
        .filter(x => x.subject_id == subject.value)
        .map(x => x.option_id);

    const opts = options.filter(o => allowed.includes(o.id));

    fill(option, opts, "ุงุฎุชุฑ ุงูููุน...");
    option.disabled = false;
};

// option โ child
option.onchange = () => {
    fill(child, children.filter(c => c.option_id == option.value), "ุงุฎุชุฑ ุงููุณู...");
    child.disabled = false;
};

// child โ subchild
child.onchange = () => {
    const subs = subchildren.filter(sc => sc.child_id == child.value);
    fill(subchild, subs, subs.length ? "ุงุฎุชุฑ ุงููุณู ุงููุฑุนู..." : "ูุง ููุฌุฏ");
    subchild.disabled = subs.length === 0;
};

// Load stages at start
fill(stage, stages, "ุงุฎุชุฑ ุงููุฑุญูุฉ...");
</script>

</body>
</html>
